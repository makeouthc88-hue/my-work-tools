<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€±çµæ¥­ç¸¾ (é›²ç«¯ç‰ˆ)</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f0f2f6; padding: 20px; }
        .box { background: white; padding: 20px; border-radius: 10px; max-width: 800px; margin: 0 auto; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        textarea { width: 100%; height: 200px; padding: 10px; border: 1px solid #ccc; font-size: 16px; border-radius: 5px; box-sizing: border-box;}
        h1 { text-align: center; color: #333; }
        .status { text-align: right; color: green; font-weight: bold; font-size: 14px; height: 20px; }
        .btn { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; width: 100%; margin-top: 10px; }
        .report { margin-top: 20px; white-space: pre-wrap; background: #fff; padding: 20px; border-radius: 10px; display: none; }
    </style>
</head>
<body>

    <h1>ğŸ“Š é€±çµæ¥­ç¸¾è¨ˆç®— (åŒæ­¥ä¸­)</h1>
    <div class="box">
        <div id="status" class="status">é€£ç·šä¸­...</div>
        <textarea id="inputData" placeholder="è«‹åœ¨æ­¤è²¼ä¸Šæ•¸æ“š..."></textarea>
        <button class="btn" onclick="calc()">ğŸš€ è¨ˆç®—å ±è¡¨</button>
    </div>
    <div id="report" class="report box"></div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDsUsWuynci0DP71veuu19Ht8bJmhHSkHs",
            authDomain: "worktools-f53e5.firebaseapp.com",
            databaseURL: "https://worktools-f53e5-default-rtdb.firebaseio.com",
            projectId: "worktools-f53e5",
            storageBucket: "worktools-f53e5.firebasestorage.app",
            messagingSenderId: "950551082090",
            appId: "1:950551082090:web:3c2c4962b5ffa044aec613",
            measurementId: "G-EKPY3SC0BR"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const textArea = document.getElementById('inputData');
        const statusDiv = document.getElementById('status');

        // ç›£è½é›²ç«¯
        db.ref('weekly_data').on('value', snap => {
            const val = snap.val();
            if(val && val !== textArea.value) {
                textArea.value = val;
                statusDiv.innerText = "âœ… è³‡æ–™å·²åŒæ­¥æ›´æ–°";
            }
        });

        // ä¸Šå‚³ (é˜²æ‰‹æŠ–ï¼Œå»¶é² 0.5 ç§’ä¸Šå‚³)
        let timer;
        textArea.addEventListener('input', () => {
            statusDiv.innerText = "â˜ï¸ è¼¸å…¥ä¸­...";
            clearTimeout(timer);
            timer = setTimeout(() => {
                db.ref('weekly_data').set(textArea.value).then(() => {
                    statusDiv.innerText = "âœ… å·²å„²å­˜åˆ°é›²ç«¯";
                });
            }, 500);
        });

        // ç°¡å–®è¨ˆç®—é‚è¼¯ (ä¿ç•™ä½ åŸæœ¬çš„éœ€æ±‚)
        function calc() {
            const lines = textArea.value.split('\n');
            let output = "--- è¨ˆç®—çµæœ ---\n";
            // é€™è£¡åƒ…ç¤ºç¯„é‚è¼¯ï¼Œå¯æ“´å……ä½ åŸæœ¬çš„è¤‡é›œè¨ˆç®—
            lines.forEach(line => {
                if(line.trim()) output += line + " (å·²è¨˜éŒ„)\n";
            });
            const rep = document.getElementById('report');
            rep.style.display = 'block';
            rep.innerText = "è¨ˆç®—å®Œæˆï¼è³‡æ–™å·²åœ¨é›²ç«¯å®‰å…¨å„²å­˜ã€‚\n\n" + output;
        }
    </script>
</body>
</html>